<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>&lt;br&gt;&#x4ee3;&#x7801;&#x89c4;&#x8303;</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="代码规范"><br>代码规范</h1>
<h2 id="函数命名和调用">函数命名和调用</h2>
<ul>
<li>
<p>主程序和被外部调用的函数和变量，一律使用lowerCamelCase命名格式。例如：</p>
<ul>
<li>
<p><code>startupScreen()</code></p>
</li>
<li>
<p><code>initializeEverything()</code></p>
</li>
<li>
<p><code>highestTemperature</code></p>
</li>
</ul>
</li>
<li>
<p>仅被本文件调用的函数和变量，可以随意, 建议使用 <code>__</code> 开头, 例如:</p>
<ul>
<li>
<p><code>__writeComOnLCD1602()</code></p>
</li>
<li>
<p><code>__writeDataOnLCD1602()</code></p>
</li>
<li>
<p><code>__writeByteToDS18B20()</code></p>
</li>
</ul>
</li>
<li>
<p>主程序以外的文件, 使用全局变量或传递指针调用, 全局变量和传递指针的使用原则为:</p>
<ol>
<li>只被读取或调用的变量或函数, 采用全局变量 <code>extern</code> 关键字声明, 例如:</li>
</ol>
<ul>
<li><code>extern void initializeFan();</code></li>
</ul>
<ol start="2">
<li>需要修改变量内容的位置, 采用传递指针调用, 例如:</li>
</ol>
<ul>
<li><code>void writeAT24C02(unsigned char addr, unsigned char dat);</code></li>
</ul>
</li>
</ul>
<h1 id="引脚地址定义"><br>引脚/地址定义</h1>
<table>
<thead>
<tr>
<th style="text-align:center">变量</th>
<th style="text-align:center">引脚/地址</th>
<th style="text-align:center">功能</th>
<th style="text-align:center">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">SETTING_BUTTON</td>
<td style="text-align:center">P3^7</td>
<td style="text-align:center">设置按钮</td>
<td style="text-align:center">S1键</td>
</tr>
<tr>
<td style="text-align:center">ADD_BUTTON</td>
<td style="text-align:center">P3^6</td>
<td style="text-align:center">加按钮</td>
<td style="text-align:center">S2键</td>
</tr>
<tr>
<td style="text-align:center">SUB_BUTTON</td>
<td style="text-align:center">P3^5</td>
<td style="text-align:center">减按钮</td>
<td style="text-align:center">S3键</td>
</tr>
<tr>
<td style="text-align:center">APPLY_BUTTON</td>
<td style="text-align:center">P3^4</td>
<td style="text-align:center">应用按钮</td>
<td style="text-align:center">S4键</td>
</tr>
<tr>
<td style="text-align:center">RST_BUTTON</td>
<td style="text-align:center">P3^3</td>
<td style="text-align:center">复位按钮</td>
<td style="text-align:center">S5键</td>
</tr>
<tr>
<td style="text-align:center">DEBUG_BUTTON</td>
<td style="text-align:center">P3^2</td>
<td style="text-align:center">调试按钮</td>
<td style="text-align:center">S6键</td>
</tr>
<tr>
<td style="text-align:center">BEEP</td>
<td style="text-align:center">P1^4</td>
<td style="text-align:center">蜂鸣器</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">LED</td>
<td style="text-align:center">P2^0</td>
<td style="text-align:center">LED灯</td>
<td style="text-align:center">单片机上D7位置的LED灯</td>
</tr>
<tr>
<td style="text-align:center">FAN</td>
<td style="text-align:center">P2^7</td>
<td style="text-align:center">风扇</td>
<td style="text-align:center">使用时注意跳线</td>
</tr>
<tr>
<td style="text-align:center">DSPORT</td>
<td style="text-align:center">P1^5</td>
<td style="text-align:center">DS18B20数据线</td>
<td style="text-align:center">DS18B20内部变量</td>
</tr>
<tr>
<td style="text-align:center">SCL</td>
<td style="text-align:center">P1^6</td>
<td style="text-align:center">I2C时钟线</td>
<td style="text-align:center">AT24C02内部变量</td>
</tr>
<tr>
<td style="text-align:center">SDA</td>
<td style="text-align:center">P1^7</td>
<td style="text-align:center">I2C数据线</td>
<td style="text-align:center">AT24C02内部变量</td>
</tr>
<tr>
<td style="text-align:center">LCD1602_E</td>
<td style="text-align:center">P1^2</td>
<td style="text-align:center">LCD1602使能线</td>
<td style="text-align:center">LCD1602内部变量</td>
</tr>
<tr>
<td style="text-align:center">LCD1602_RW</td>
<td style="text-align:center">P1^1</td>
<td style="text-align:center">LCD1602读/写选择线</td>
<td style="text-align:center">LCD1602内部变量</td>
</tr>
<tr>
<td style="text-align:center">LCD1602_RS</td>
<td style="text-align:center">P1^0</td>
<td style="text-align:center">LCD1602寄存器选择线</td>
<td style="text-align:center">LCD1602内部变量</td>
</tr>
<tr>
<td style="text-align:center">AT24C02_ADD</td>
<td style="text-align:center">0xA0</td>
<td style="text-align:center">AT24C02设备地址</td>
<td style="text-align:center">AT24C02内部变量</td>
</tr>
</tbody>
</table>
<h1 id="主程序"><br><br>主程序</h1>
<ul>
<li>main.c</li>
</ul>
<h4 id="全局变量">全局变量</h4>
<ul>
<li>
<p><code>SETTING_BUTTON</code>，<code>ADD_BUTTON</code>，<code>SUB_BUTTON</code>，<code>APPLY_BUTTON</code>，<code>RST_BUTTON</code>，<code>DEBUG_BUTTON</code>，<code>BEEP</code>，<code>LED</code>，<code>FAN</code>：这些是连接到P3和P1、P2端口的各种按钮和设备的引脚。</p>
</li>
<li>
<p><code>TH_INIT</code>，<code>TL_INIT</code>：定时器初值。</p>
</li>
<li>
<p><code>fanLevel</code>：风扇档位，0档: 0%转速，1档: 50%转速, 2档: 75%转速, 3档: 100%转速。</p>
</li>
<li>
<p><code>fanState</code>：用于控制风扇转速（0: 关闭, 1: 打开）。</p>
</li>
<li>
<p><code>currentTemperature</code>：当前温度。</p>
</li>
<li>
<p><code>highestTemperature</code>，<code>lowestTemperature</code>：最高和最低温度。</p>
</li>
<li>
<p><code>firstLine</code>，<code>secondLine</code>：用于在屏幕上显示的字符数组。</p>
</li>
<li>
<p><code>onScreenHighestTemperature</code>，<code>onScreenLowestTemperature</code>，<code>onScreenCurrentTemperature</code>，<code>onScreenFanLevel</code>：指向屏幕上显示的各种温度和风扇档位的指针。</p>
</li>
</ul>
<h4 id="主函数">主函数</h4>
<ul>
<li><code>main()</code>：程序的入口点。初始化所有设备，显示启动屏幕，然后进入主循环。在主循环中，检查复位按钮是否被按下，如果是，则重置最高和最低温度。</li>
</ul>
<h1 id="屏幕"><br><br>屏幕</h1>
<h2 id="开机启动屏幕"><br>开机启动屏幕</h2>
<ul>
<li>startupScreen.c</li>
</ul>
<h4 id="函数">函数</h4>
<ul>
<li><code>startupScreen()</code>：显示开机画面。首先定义两行字符，然后逐个显示这两行字符，每显示一个字符后延时50毫秒，显示完所有字符后延时1秒，然后将所有字符向左移动一格，最后一格改为空格，每移动一格后延时25毫秒，直到所有字符都移出屏幕。这个函数没有输入参数和返回值。</li>
</ul>
<h4 id="注意事项">注意事项</h4>
<ul>
<li>在使用这个函数时，需要确保LCD1602已经正确连接到相应的端口，并且<code>putStringOnLCD1602</code>和<code>writeCharOnLCD1602</code>函数已经被正确实现。</li>
</ul>
<h2 id="主屏幕"><br>主屏幕</h2>
<ul>
<li>mainScreen.c</li>
</ul>
<h4 id="全局变量-1">全局变量</h4>
<ul>
<li>
<p><code>LED</code>，<code>BEEP</code>：LED灯和蜂鸣器连接的端口。</p>
</li>
<li>
<p><code>fanLevel</code>：风扇的档位。</p>
</li>
<li>
<p><code>fanState[4]</code>：风扇的状态数组，每个元素代表一个PWM占空比。</p>
</li>
<li>
<p><code>currentTemperature</code>：当前温度。</p>
</li>
<li>
<p><code>highestTemperature</code>，<code>lowestTemperature</code>：存储的最高温度和最低温度。</p>
</li>
<li>
<p><code>onScreenHighestTemperature</code>，<code>onScreenLowestTemperature</code>，<code>onScreenCurrentTemperature</code>，<code>onScreenFanLevel</code>：显示在屏幕上的最高温度，最低温度，当前温度和风扇档位。</p>
</li>
<li>
<p><code>firstLine[]</code>，<code>secondLine[]</code>：显示在屏幕上的第一行和第二行的字符。</p>
</li>
</ul>
<h4 id="函数-1">函数</h4>
<ul>
<li><code>mainScreen()</code>：显示主屏幕。首先处理存储的最高温度和最低温度，然后处理当前温度，然后处理风扇档位，然后根据当前温度设置LED灯的状态，然后根据当前温度设置蜂鸣器的状态，然后根据当前温度设置风扇的状态。这个函数没有输入参数和返回值。</li>
</ul>
<h4 id="注意事项-1">注意事项</h4>
<ul>
<li>在使用这个函数时，需要确保LED灯，蜂鸣器，风扇，DS18B20，AT24C02和LCD1602已经正确连接到相应的端口，并且所有设备的初始化函数和操作函数已经被正确实现。</li>
</ul>
<h2 id="设置屏幕"><br>设置屏幕</h2>
<ul>
<li>settingScreen.c</li>
</ul>
<h4 id="全局变量-2">全局变量</h4>
<ul>
<li>
<p><code>SETTING_BUTTON</code>，<code>ADD_BUTTON</code>，<code>SUB_BUTTON</code>，<code>APPLY_BUTTON</code>，<code>RST_BUTTON</code>，<code>DEBUG_BUTTON</code>：各种按钮连接的端口。</p>
</li>
<li>
<p><code>highestTemperature</code>，<code>lowestTemperature</code>：存储的最高温度和最低温度。</p>
</li>
<li>
<p><code>onScreenHighestTemperature</code>，<code>onScreenLowestTemperature</code>：显示在屏幕上的最高温度和最低温度。</p>
</li>
<li>
<p><code>firstLine[]</code>，<code>secondLine[]</code>：显示在屏幕上的第一行和第二行的字符。</p>
</li>
</ul>
<h4 id="函数-2">函数</h4>
<ul>
<li><code>settingScreen()</code>：显示设置屏幕。首先等待按键释放，然后显示&quot;Setting...&quot;，然后进入一个循环，如果按下APPLY_BUTTON则退出循环，如果光标位置发生变化，则重新显示屏幕画面，如果再次按下SETTING_BUTTON则切换光标位置。这个函数没有输入参数和返回值。</li>
</ul>
<h4 id="注意事项-2">注意事项</h4>
<ul>
<li>在使用这个函数时，需要确保所有按钮，AT24C02和LCD1602已经正确连接到相应的端口，并且所有设备的初始化函数和操作函数已经被正确实现。</li>
</ul>
<h2 id="消息屏幕"><br>消息屏幕</h2>
<ul>
<li>alartScreen.c</li>
</ul>
<h4 id="函数-3">函数</h4>
<ul>
<li><code>alartScreen(unsigned char text[])</code>：显示警告屏幕。首先清屏，然后计算居中位置，然后显示字符串，最后延时300毫秒。这个函数的输入参数是要显示的字符串，没有返回值。</li>
</ul>
<h4 id="注意事项-3">注意事项</h4>
<ul>
<li>在使用这个函数时，需要确保LCD1602已经正确连接到相应的端口，并且<code>clearLineInLCD1602</code>和<code>putStringOnLCD1602</code>函数已经被正确实现。</li>
</ul>
<h1 id="组件函数"><br><br>组件函数</h1>
<h2 id="at24c02-eeprom"><br>AT24C02 EEPROM</h2>
<ul>
<li>AT24C02.c</li>
</ul>
<h4 id="内部变量">内部变量</h4>
<ul>
<li><code>AT24C02_ADD</code>：AT24C02的设备地址。</li>
</ul>
<h4 id="函数-4">函数</h4>
<ul>
<li>
<p><code>writeAT24C02(unsigned char addr, unsigned char dat)</code>：向AT24C02的一个地址写入一个数据。地址范围为0x00-0xFF。写入数据后，会有300毫秒的延迟。</p>
</li>
<li>
<p><code>readAT24C02(unsigned char addr)</code>：读取AT24C02的一个地址的数据。地址范围为0x00-0xFF。读取数据后，会有300毫秒的延迟。</p>
</li>
</ul>
<h4 id="注意事项-4">注意事项</h4>
<ul>
<li>在向AT24C02写入数据时，不能写的太快，需要加一个延迟。经测试，1秒的延迟是稳定的，可以尝试调整参数以提高频率。</li>
</ul>
<h4 id="延时函数">延时函数</h4>
<ul>
<li>DELAY.c</li>
</ul>
<h4 id="函数-5">函数</h4>
<ul>
<li>
<p><code>delayOneMillisecond(unsigned int n)</code>：延时n毫秒，误差5%。这个函数使用了一个简单的for循环来实现延时。</p>
</li>
<li>
<p><code>delayOneSecond(unsigned int n)</code>：延时n秒，误差5%。这个函数通过调用<code>delayOneMillisecond(1000)</code> n次来实现延时。</p>
</li>
<li>
<p><code>delayTenMicroseconds(unsigned int n)</code>：延时n*10微秒，误差80%。这个函数使用了一个while循环来实现延时。</p>
</li>
</ul>
<h4 id="注意事项-5">注意事项</h4>
<ul>
<li>这些延时函数的误差较大，特别是<code>delayTenMicroseconds(unsigned int n)</code>函数，误差高达80%。在需要精确延时的场合，可能需要使用其他方法。</li>
</ul>
<h2 id="ds18b20温度传感器"><br>DS18B20温度传感器</h2>
<ul>
<li>DS18B20.c</li>
</ul>
<h4 id="内部变量-1">内部变量</h4>
<ul>
<li><code>DSPORT</code>：DS18B20的数据线连接的端口。</li>
</ul>
<h4 id="函数-6">函数</h4>
<ul>
<li>
<p><code>initializeDS18B20(void)</code>：初始化DS18B20。首先将总线拉低480us~960us，然后释放总线，等待DS18B20将总线拉低。如果DS18B20在5ms内没有反应，则初始化失败，返回0。否则，初始化成功，返回1。</p>
</li>
<li>
<p><code>writeByteToDS18B20(unsigned char dat)</code>：向DS18B20写入一个字节的数据。每写入一位数据之前，先将总线拉低1us，然后写入数据，从最低位开始。写入数据后，延时68us，然后释放总线，至少1us给总线恢复时间才能接着写入下一个数据。</p>
</li>
<li>
<p><code>readByteFromDS18B20(void)</code>：从DS18B20读取一个字节的数据。这个函数的实现在代码的下一部分。</p>
</li>
</ul>
<h4 id="注意事项-6">注意事项</h4>
<ul>
<li>在使用这些函数时，需要确保DS18B20的数据线已经正确连接到<code>DSPORT</code>所代表的端口。</li>
</ul>
<h2 id="pwm风扇"><br>PWM风扇</h2>
<ul>
<li>FAN_PWM.c</li>
</ul>
<h4 id="全局变量-3">全局变量</h4>
<ul>
<li>
<p><code>FAN</code>：风扇连接的端口。</p>
</li>
<li>
<p><code>fanState[4]</code>：风扇的状态数组，每个元素代表一个PWM占空比。</p>
</li>
<li>
<p><code>TH_INIT</code>，<code>TL_INIT</code>：定时器初值。</p>
</li>
</ul>
<h4 id="函数-7">函数</h4>
<ul>
<li>
<p><code>initializeFan()</code>：初始化风扇和定时器0。首先关闭风扇，然后设置定时器0的模式和初值，清除TF0标志，开始定时器0的计时，使能定时器0中断，开启总中断。这个函数没有输入参数和返回值。</p>
</li>
<li>
<p><code>PWM() interrupt 1</code>：定时器0的中断服务程序。每次中断，都会重新设置定时器初值，然后根据<code>fanState[i%4]</code>设置风扇的状态。<code>i</code>是一个静态变量，每次中断都会增加1，当<code>i</code>达到100时，将<code>i</code>重置为0。这个函数没有输入参数和返回值。</p>
</li>
</ul>
<h4 id="注意事项-7">注意事项</h4>
<ul>
<li>在使用这些函数时，需要确保风扇已经正确连接到<code>FAN</code>所代表的端口，并且<code>fanState</code>数组已经被正确初始化。</li>
</ul>
<h2 id="iic总线"><br>IIC总线</h2>
<ul>
<li>IIC.c</li>
</ul>
<h4 id="内部变量-2">内部变量</h4>
<ul>
<li><code>SCL</code>，<code>SDA</code>：I2C的时钟线和数据线连接的端口。</li>
</ul>
<h4 id="函数-8">函数</h4>
<ul>
<li>
<p><code>startIIC(void)</code>：发送I2C起始信号。首先将SDA和SCL拉高，然后将SDA拉低，最后将SCL拉低。每个步骤之间有一个延时。这个函数没有输入参数和返回值。</p>
</li>
<li>
<p><code>stopIIC(void)</code>：发送I2C终止信号。首先将SDA拉低，然后将SCL拉高，最后将SDA拉高。每个步骤之间有一个延时。这个函数没有输入参数和返回值。</p>
</li>
<li>
<p><code>sendByteToIIC(unsigned char dat)</code>：通过I2C发送一个字节的数据。首先将SDA设置为数据的最高位，然后将数据左移一位，然后将SCL拉高，最后将SCL拉低。这个过程重复8次，发送完一个字节的数据。发送完数据后，将SDA拉高。这个函数的输入参数是要发送的数据，返回值是1。</p>
</li>
</ul>
<h4 id="注意事项-8">注意事项</h4>
<ul>
<li>在使用这些函数时，需要确保I2C的时钟线和数据线已经正确连接到<code>SCL</code>和<code>SDA</code>所代表的端口。</li>
</ul>
<h2 id="lcd1602显示屏"><br>LCD1602显示屏</h2>
<ul>
<li>LCD1602.c</li>
</ul>
<h4 id="内部变量-3">内部变量</h4>
<ul>
<li>
<p><code>LCD1602_DATAPINS</code>：LCD1602的数据线连接的端口。</p>
</li>
<li>
<p><code>LCD1602_E</code>，<code>LCD1602_RW</code>，<code>LCD1602_RS</code>：LCD1602的使能线，读/写选择线，寄存器选择线连接的端口。</p>
</li>
</ul>
<h4 id="函数-9">函数</h4>
<ul>
<li>
<p><code>__writeComOnLCD1602(unsigned char com)</code>：向LCD1602写入一个命令。首先将使能线拉低，选择发送命令，选择写入，然后将命令放入数据线，等待数据稳定，然后将使能线拉高，保持一段时间，最后将使能线拉低。这个函数的输入参数是要写入的命令，没有返回值。</p>
</li>
<li>
<p><code>__writeDataOnLCD1602(unsigned char dat)</code>：向LCD1602写入一个字节的数据。首先将使能线拉低，选择输入数据，选择写入，然后将数据放入数据线，等待数据稳定，然后将使能线拉高，保持一段时间，最后将使能线拉低。这个函数的输入参数是要写入的数据，没有返回值。</p>
</li>
<li>
<p><code>initializeLCD1602(void)</code>：初始化LCD1602。首先开显示，然后开显示不显示光标，然后写一个指针加1，然后清屏，最后设置数据指针起点。这个函数没有输入参数和返回值。</p>
</li>
<li>
<p><code>clearLineInLCD1602(unsigned char row)</code>：清除LCD1602的第0行或第1行的数据。这个函数的输入参数是要清除的行号，没有返回值。</p>
</li>
</ul>
<h4 id="注意事项-9">注意事项</h4>
<ul>
<li>在使用这些函数时，需要确保LCD1602的数据线，使能线，读/写选择线，寄存器选择线已经正确连接到相应的端口。</li>
</ul>
<h2 id="蜂鸣器"><br>蜂鸣器</h2>
<ul>
<li>BEEP.c</li>
</ul>
<h4 id="内部变量-4">内部变量</h4>
<ul>
<li>
<p><code>H4_</code>，<code>H5</code>，<code>H5_</code>，<code>H6</code>，<code>H6_</code>，<code>H7</code>：音符的频率索引。</p>
</li>
<li>
<p><code>FreqTable</code>：频率表，索引与频率对照表。</p>
</li>
<li>
<p><code>Music</code>：乐谱，音符与索引对应表，P：休止符，L：低音，M：中音，H：高音，下划线：升半音符号。</p>
</li>
</ul>
<h4 id="函数-10">函数</h4>
<ul>
<li>
<p><code>initializeBeep()</code>：初始化蜂鸣器。首先关闭蜂鸣器，然后设置定时器1的模式和初值，清除TF1标志，开始定时器1的计时，使能定时器1中断，开启总中断。这个函数没有输入参数和返回值。</p>
</li>
<li>
<p><code>playMusic(unsigned char *music)</code>：播放乐谱。首先关闭蜂鸣器，然后设置定时器1的模式和初值，清除TF1标志，开始定时器1的计时，使能定时器1中断，开启总中断，然后根据乐谱设置定时器1的初值和蜂鸣器的状态。这个函数的输入参数是乐谱，没有返回值。</p>
</li>
</ul>
<h4 id="注意事项-10">注意事项</h4>
<ul>
<li>在使用这些函数时，需要确保蜂鸣器已经正确连接到相应的端口，并且<code>FreqTable</code>和<code>Music</code>已经被正确初始化。</li>
</ul>
<h2 id="其他功能"><br>其他功能</h2>
<ul>
<li>FUNCTIONS.c</li>
</ul>
<h4 id="函数-11">函数</h4>
<ul>
<li><code>initializeEverything()</code>：初始化所有设备。首先关闭蜂鸣器，风扇和LED，然后初始化风扇，LCD1602和DS18B20。这个函数没有输入参数和返回值。</li>
</ul>
<h4 id="注意事项-11">注意事项</h4>
<ul>
<li>在使用这个函数时，需要确保所有设备已经正确连接到相应的端口，并且所有设备的初始化函数已经被正确实现。</li>
</ul>

        
        
    </body>
    </html>