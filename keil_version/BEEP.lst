C51 COMPILER V9.01   BEEP                                                                  12/05/2023 20:14:37 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE BEEP
OBJECT MODULE PLACED IN BEEP.obj
COMPILER INVOKED BY: D:\Program Files\Keil\C51\BIN\C51.EXE src\utils\BEEP.c ROM(COMPACT) BROWSE DEBUG OBJECTEXTEND PRINT
                    -(.\BEEP.lst) OBJECT(BEEP.obj)

line level    source

   1          #include <reg52.h>
   2          #include "DELAY.h"
   3          
   4          sbit BEEP = P1^4;
   5          
   6          //播放速度，值为四分音符的时长(ms)
   7          #define SPEED   500
   8          
   9          //音符与索引对应表，P：休止符，L：低音，M：中音，H：高音，下划线：升半音符号#
  10          #define P       0
  11          #define L1      1
  12          #define L1_     2
  13          #define L2      3
  14          #define L2_     4
  15          #define L3      5
  16          #define L4      6
  17          #define L4_     7
  18          #define L5      8
  19          #define L5_     9
  20          #define L6      10
  21          #define L6_     11
  22          #define L7      12
  23          #define M1      13
  24          #define M1_     14
  25          #define M2      15
  26          #define M2_     16
  27          #define M3      17
  28          #define M4      18
  29          #define M4_     19
  30          #define M5      20
  31          #define M5_     21
  32          #define M6      22
  33          #define M6_     23
  34          #define M7      24
  35          #define H1      25
  36          #define H1_     26
  37          #define H2      27
  38          #define H2_     28
  39          #define H3      29
  40          #define H4      30
  41          #define H4_     31
  42          #define H5      32
  43          #define H5_     33
  44          #define H6      34
  45          #define H6_     35
  46          #define H7      36
  47          
  48          //索引与频率对照表
  49          xdata unsigned int FreqTable[]={
  50                  0,
  51                  63628,63731,63835,63928,64021,64103,64185,64260,64331,64400,64463,64528,
  52                  64580,64633,64684,64732,64777,64820,64860,64898,64934,64968,65000,65030,
  53                  65058,65085,65110,65134,65157,65178,65198,65217,65235,65252,65268,65283,
  54          };
C51 COMPILER V9.01   BEEP                                                                  12/05/2023 20:14:37 PAGE 2   

  55          
  56          //乐谱
  57          //音符与索引对应表，P：休止符，L：低音，M：中音，H：高音，下划线：升半音符号#
  58          xdata unsigned char Music[]={
  59                  //音符,时值,
  60              // 前奏
  61                  H1, 4,
  62              H2, 4,
  63              M5, 4,
  64              H2, 4,
  65              H3, 4,
  66              M5, 1,
  67              M4, 1,
  68              M3, 1,
  69              M1, 1,
  70          
  71                  H1, 4,
  72              H2, 4,
  73              M5, 4,
  74              M5, 4,
  75              P,  4,
  76              M5, 1,
  77              M5, 1,
  78              M5, 1,
  79              M6, 1,
  80              M1, 1,
  81              M6, 1,
  82              M1, 1,
  83          
  84                  H1, 4,
  85              H2, 4,
  86              M5, 4,
  87              H2, 4,
  88              H3, 4,
  89              M5, 1,
  90              M4, 1,
  91              M3, 1,
  92              M1, 1,
  93          
  94                  H1, 4,
  95              H2, 4,
  96              M5, 4,
  97              M5, 4,
  98              P,  4,
  99              M1, 1,
 100              M1, 1,
 101              L7, 1,
 102              M1, 1,
 103              L7, 1,
 104              M1, 1,
 105          
 106              // Never gonna give you up
 107              M5, 1, 
 108              M6, 1,
 109              M1, 1,
 110              M6, 1,
 111              H3, 4,
 112              H3, 4,
 113              H2, 4,
 114          
 115              // Never gonna let you down
 116              M5, 1, 
C51 COMPILER V9.01   BEEP                                                                  12/05/2023 20:14:37 PAGE 3   

 117              M6, 1,
 118              M1, 1,
 119              M6, 1,
 120              H2, 4,
 121              H2, 4,
 122              M1, 4,
 123              M7, 1,
 124              M6, 1,
 125          
 126              // Never gonna run around and desert you
 127              M5, 1, 
 128              M6, 1,
 129              M1, 1,
 130              M6, 1,
 131              M1, 4,
 132              M2, 2,
 133              M7, 2,
 134              M6, 1,
 135              M5, 2,
 136              P,  1,
 137              M5, 2,
 138              M2, 4,
 139          
 140                  0xFF    //终止标志
 141          };
 142          
 143          unsigned char FreqSelect=0, MusicSelect=0;
 144          
 145          
 146          void initializeBeeper() {
 147   1          // 默认关闭蜂鸣器
 148   1          BEEP = 1;
 149   1          // 初始化定时器1
 150   1          TMOD &= 0x0F;   // 清除定时器1模式位
 151   1          TMOD |= 0x10;   // 设置定时器模式
 152   1          TL1 = 0x00;  // 设置定时初值
 153   1          TH1 = 0x00;  // 设置定时初值
 154   1          TF1 = 0;    // 清除TF1标志
 155   1          TR1 = 1;    // 定时器1开始计时
 156   1          ET1 = 1;    // 使能定时器1中断
 157   1          EA = 1; // 开启总中断
 158   1      }
 159          
 160          void BEEPER () interrupt 3 {
 161   1          if(FreqTable[FreqSelect]) { //如果不是休止符
 162   2                      /*取对应频率值的重装载值到定时器*/
 163   2                      TL1 = FreqTable[FreqSelect]%256;                //设置定时初值
 164   2                      TH1 = FreqTable[FreqSelect]/256;                //设置定时初值
 165   2                      BEEP=!BEEP;     //翻转蜂鸣器IO口
 166   2              }
 167   1      }
 168          
 169          void doBeep() {
 170   1              while(1) {
 171   2                      if(Music[MusicSelect]!=0xFF) {  // 如果不是停止标志位
 172   3                              FreqSelect=Music[MusicSelect];  // 选择音符对应的频率
 173   3                              MusicSelect++;
 174   3                              delayOneMillisecond(SPEED/4*Music[MusicSelect]);  // 选择音符对应的时值
 175   3                              MusicSelect++;
 176   3                              TR1 = 0;
 177   3                              delayOneMillisecond(5); // 音符间短暂停顿
 178   3                              TR1 = 1;
C51 COMPILER V9.01   BEEP                                                                  12/05/2023 20:14:37 PAGE 4   

 179   3                      }
 180   2                      else {  // 如果是停止标志位
 181   3                              TR1 = 0;
 182   3                  BEEP = 1;
 183   3                              break;
 184   3                      }
 185   2              }
 186   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    152    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    213    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
