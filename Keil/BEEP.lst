C51 COMPILER V9.01   BEEP                                                                  12/06/2023 12:06:33 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE BEEP
OBJECT MODULE PLACED IN .\BEEP.obj
COMPILER INVOKED BY: D:\Program Files\Keil\C51\BIN\C51.EXE ..\eide\src\utils\BEEP.c BROWSE DEBUG OBJECTEXTEND PRINT(.\BE
                    -EP.lst) OBJECT(.\BEEP.obj)

line level    source

   1          #include "BEEP.h"
   2          
   3          //音符与索引对应表，P：休止符，L：低音，M：中音，H：高音，下划线：升半音符号#
   4          #define P       0
   5          #define L1      1
   6          #define L1_     2
   7          #define L2      3
   8          #define L2_     4
   9          #define L3      5
  10          #define L4      6
  11          #define L4_     7
  12          #define L5      8
  13          #define L5_     9
  14          #define L6      10
  15          #define L6_     11
  16          #define L7      12
  17          #define M1      13
  18          #define M1_     14
  19          #define M2      15
  20          #define M2_     16
  21          #define M3      17
  22          #define M4      18
  23          #define M4_     19
  24          #define M5      20
  25          #define M5_     21
  26          #define M6      22
  27          #define M6_     23
  28          #define M7      24
  29          #define H1      25
  30          #define H1_     26
  31          #define H2      27
  32          #define H2_     28
  33          #define H3      29
  34          #define H4      30
  35          #define H4_     31
  36          #define H5      32
  37          #define H5_     33
  38          #define H6      34
  39          #define H6_     35
  40          #define H7      36
  41          
  42          //索引与频率对照表
  43          xdata unsigned int FreqTable[]={
  44                  0,
  45                  63628,63731,63835,63928,64021,64103,64185,64260,64331,64400,64463,64528,
  46                  64580,64633,64684,64732,64777,64820,64860,64898,64934,64968,65000,65030,
  47                  65058,65085,65110,65134,65157,65178,65198,65217,65235,65252,65268,65283,
  48          };
  49          
  50          //乐谱
  51          //音符与索引对应表，P：休止符，L：低音，M：中音，H：高音，下划线：升半音符号#
  52          xdata unsigned char Music[]={
  53                  //音符,时值,
  54              // 前奏
C51 COMPILER V9.01   BEEP                                                                  12/06/2023 12:06:33 PAGE 2   

  55                  H1, 4,
  56              H2, 4,
  57              M5, 4,
  58              H2, 4,
  59              H3, 4,
  60              M5, 1,
  61              M4, 1,
  62              M3, 1,
  63              M1, 1,
  64          
  65                  H1, 4,
  66              H2, 4,
  67              M5, 4,
  68              M5, 4,
  69              P,  4,
  70              M5, 1,
  71              M5, 1,
  72              M5, 1,
  73              M6, 1,
  74              M1, 1,
  75              M6, 1,
  76              M1, 1,
  77          
  78                  H1, 4,
  79              H2, 4,
  80              M5, 4,
  81              H2, 4,
  82              H3, 4,
  83              M5, 1,
  84              M4, 1,
  85              M3, 1,
  86              M1, 1,
  87          
  88                  H1, 4,
  89              H2, 4,
  90              M5, 4,
  91              M5, 4,
  92              P,  4,
  93              M1, 1,
  94              M1, 1,
  95              L7, 1,
  96              M1, 1,
  97              L7, 1,
  98              M1, 1,
  99          
 100              // Never gonna give you up
 101              M5, 1, 
 102              M6, 1,
 103              M1, 1,
 104              M6, 1,
 105              H3, 4,
 106              H3, 4,
 107              H2, 4,
 108          
 109              // Never gonna let you down
 110              M5, 1, 
 111              M6, 1,
 112              M1, 1,
 113              M6, 1,
 114              H2, 4,
 115              H2, 4,
 116              M1, 4,
C51 COMPILER V9.01   BEEP                                                                  12/06/2023 12:06:33 PAGE 3   

 117              M7, 1,
 118              M6, 1,
 119          
 120              // Never gonna run around and desert you
 121              M5, 1, 
 122              M6, 1,
 123              M1, 1,
 124              M6, 1,
 125              M1, 4,
 126              M2, 2,
 127              M7, 2,
 128              M6, 1,
 129              M5, 2,
 130              P,  1,
 131              M5, 2,
 132              M2, 4,
 133          
 134                  0xFF    //终止标志
 135          };
 136          
 137          unsigned char FreqSelect=0, MusicSelect=0;
 138          
 139          
 140          void initializeBeeper() {
 141   1          // 默认关闭蜂鸣器
 142   1          BEEP = 1;
 143   1          // 初始化定时器1
 144   1          TMOD &= 0x0F;   // 清除定时器1模式位
 145   1          TMOD |= 0x10;   // 设置定时器模式
 146   1          TL1 = 0x00;  // 设置定时初值
 147   1          TH1 = 0x00;  // 设置定时初值
 148   1          TF1 = 0;    // 清除TF1标志
 149   1          TR1 = 1;    // 定时器1开始计时
 150   1          ET1 = 1;    // 使能定时器1中断
 151   1          EA = 1; // 开启总中断
 152   1      }
 153          
 154          void BEEPER () interrupt 3 {
 155   1          if(FreqTable[FreqSelect]) { //如果不是休止符
 156   2                      /*取对应频率值的重装载值到定时器*/
 157   2                      TL1 = FreqTable[FreqSelect]%256;                //设置定时初值
 158   2                      TH1 = FreqTable[FreqSelect]/256;                //设置定时初值
 159   2                      BEEP=!BEEP;     //翻转蜂鸣器IO口
 160   2              }
 161   1      }
 162          
 163          void doBeep() {
 164   1              while(1) {
 165   2                      if(Music[MusicSelect]!=0xFF) {  // 如果不是停止标志位
 166   3                              FreqSelect=Music[MusicSelect];  // 选择音符对应的频率
 167   3                              MusicSelect++;
 168   3                              delayOneMillisecond(SPEED/4*Music[MusicSelect]);  // 选择音符对应的时值
 169   3                              MusicSelect++;
 170   3                              TR1 = 0;
 171   3                              delayOneMillisecond(5); // 音符间短暂停顿
 172   3                              TR1 = 1;
 173   3                      }
 174   2                      else {  // 如果是停止标志位
 175   3                              TR1 = 0;
 176   3                  BEEP = 1;
 177   3                              break;
 178   3                      }
C51 COMPILER V9.01   BEEP                                                                  12/06/2023 12:06:33 PAGE 4   

 179   2              }
 180   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    152    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    213    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
